const i18nData={"zh-CN":{"searchPlaceholder":"搜索...","noResults":"没有找到匹配的结果","tocTitle":"目录","tocToggle":"收起","footerText":"威四方-在线文档. 保留所有权利.","about":"关于我们","help":"帮助中心","privacy":"隐私政策","home":"首页","guide":"指南","api":"API","component":"组件","faq":"常见问题","welcome":"欢迎","logoText":"文档系统","toggleMenu":"切换菜单","toggleTheme":"切换主题","toggleLanguage":"切换语言","moreOptions":"更多选项"},"en-US":{"searchPlaceholder":"Search...","noResults":"No matching results found","tocTitle":"Table of Contents","tocToggle":"Collapse","footerText":"WeiSiFang Docs. All rights reserved.","about":"About Us","help":"Help Center","privacy":"Privacy Policy","home":"Home","guide":"Guide","api":"API","component":"Components","faq":"FAQ","welcome":"Welcome","logoText":"DocSystem","toggleMenu":"Toggle Menu","toggleTheme":"Toggle Theme","toggleLanguage":"Toggle Language","moreOptions":"More Options"}};const langCodeMap={"zh-CN":"CN","en-US":"EN",};const sidebar=document.getElementById('sidebar');const sidebarToggle=document.getElementById('sidebarToggle');const menuContainer=document.getElementById('menuContainer');const content=document.getElementById('content');const navTabs=document.getElementById('navTabs');const navTabItems=document.querySelectorAll('.nav-tab');const searchInput=document.getElementById('searchInput');const searchResults=document.getElementById('searchResults');const searchContainer=document.getElementById('searchContainer');const themeToggle=document.getElementById('themeToggle');const languageToggle=document.getElementById('languageToggle');const languageMenu=document.getElementById('languageMenu');const langBadge=document.getElementById('langBadge');const userAvatar=document.getElementById('userAvatar');const userCard=document.getElementById('userCard');const headerMenuToggle=document.getElementById('headerMenuToggle');const toc=document.getElementById('toc');const tocList=document.getElementById('tocList');const tocTitle=document.querySelector('.toc-title');const tocToggle=document.getElementById('tocToggle');const tocCollapseHandle=document.getElementById('tocCollapseHandle');const articleContent=document.getElementById('articleContent');const footer=document.querySelector('.footer');const footerText=document.getElementById('footerText');const logoText=document.getElementById('logoText');const backToTop=document.getElementById('backToTop');const tocTitleText=document.getElementById('tocTitleText');let currentCategory='guide';let defaultCategory='guide';let sidebarOpen=false;let headerMenuOpen=false;let searchOpen=false;let currentLanguage='zh-CN';let tocCollapsed=false;function initDocsAll(){currentCategory=(typeof nav_category==='undefined'||isEmpty(nav_category))?Object.keys(menuData)[0]:nav_category;initTheme();renderMenu(currentCategory);setupEventListeners();setupScrollSpy();updateUIForLanguage();setupBackToTop();updateTOCVisibility();initDocContent()}function initDocContent(){generateTOC();setupCodeBlocks();setTimeout(()=>{typeof init_right_menu=='function'&&init_right_menu()},100);init_tips()}function initDocHead(){initTheme();pageHeadEventListeners();setupScrollSpy();updateUIForLanguage();setupBackToTop()}function initTheme(theme=''){const currentTheme=theme||localStorage.getItem('docs_theme')||document.documentElement.getAttribute('data-theme')||'';if(currentTheme){document.documentElement.setAttribute('data-theme',currentTheme||'');localStorage.setItem('docs_theme',currentTheme)}else{document.documentElement.removeAttribute('data-theme');localStorage.setItem('docs_theme','')}if(typeof cherry!=='undefined'){cherry.setTheme(currentTheme||'light')}else{setTimeout(function(){typeof cherry!=='undefined'&&cherry.setTheme(currentTheme||'light')},2000)}}function getTheme(){return localStorage.getItem('docs_theme')||document.documentElement.getAttribute('data-theme')||'light'}function getCsrfToken(){const meta=document.querySelector('meta[name="csrf-token"]');return meta?meta.getAttribute('content'):null}function findFirstDocItem(items){for(const item of items){if(item.menu_type==="doc"||item.menu_type==='app_manage_doc'){return item}if(item.children&&item.children.length>0){const found=findFirstDocItem(item.children);if(found)return found}}return null}function renderMenu(category,doc_id=null){if(typeof menuData==='undefined'||isEmpty(menuData)){return}const menu_list=menuData[category]||[];const items=Object.assign([],menu_list);let buttons=[];if(items[items.length-1]&&items[items.length-1].buttons){buttons=items.splice(items.length-1,1)[0].buttons}menuContainer.innerHTML=generateMenuHTML(items);if(buttons.length>0){menuContainer.insertAdjacentHTML('beforeend',generateButtonsHTML(buttons))}let url=window.location.pathname;doc_id=!isEmpty(doc_id)?doc_id:(typeof current_doc_id!=='undefined'?current_doc_id:'');if(isEmpty(doc_id)){let match=url.match(/\/(\d+)\/(help|edit|users)/);if(!match||!match[2]){match=url.match(/\/(\d+)_(\d+)/)}if(match&&match[2]){doc_id=match[2]}else{let find=findFirstDocItem(items);if(find){doc_id=find.id}}}if(doc_id){let menuItem=menuContainer.querySelector(`.menu-item[data-id="${doc_id}"]`);if(menuItem){menuItem.classList.add('open');menuItem.classList.add('active')}while(menuItem){menuItem=menuItem.parentElement.closest('.menu-item');if(menuItem){menuItem.classList.add('open')}}}}function generateMenuHTML(items,level=0){return items.map(item=>{const hasChildren=item.children&&item.children.length>0;const indentClass=`level-${level}`;let hasUrl=(!isEmpty(item.url)&&item.url!=='#'&&item.url!=='javascript:;');let datasetStr=hasUrl?`data-id="${item.id}"`:generateDatasetStr(item);return`<li class="menu-item ${indentClass} ${(hasChildren || item.menu_type === 'dir') ? 'has-children' : ''}"${datasetStr}><a href="${hasUrl ? item.url : '#'}"class="menu-link"data-has_url="${hasUrl ? 1 : ''}"${datasetStr}>${item.icon?`<span class="menu-icon">${item.icon}</span>`:''}<span class="menu-text">${item.title}</span>${item.badge?`<span class="menu-badge">${item.badge}</span>`:''}</a>${hasChildren?`<ul class="submenu">${generateMenuHTML(item.children,level+1)}</ul>`:''}</li>`}).join('')}function generateButtonsHTML(buttons){return buttons.map(btn=>{return`<div class="m-1 text-center"><button type="button"class="docs-app-menu-handle-btn ${btn.class??''}"data-app_id="${btn.app_id??''}"data-type="${btn.type??''}">${btn.icon?`<i class="wsf-icon icon-plus">${btn.icon}</i>`:''}${btn.title}</button></div>`}).join('')}function generateDatasetStr(obj){if(!obj){return""}let datasetStr="";for(const key in obj){if(obj.hasOwnProperty(key)&&!['children','title'].includes(key)){let value=obj[key];if(typeof value==='string'||typeof value==='number'){if(value.toString()!==''&&value.toString().length<30){datasetStr+=' data-'+key+'="'+value+'" '}else if(value.toString()===''){datasetStr+=' data-'+key+' '}}}}return datasetStr}function setupCodeBlocks(){const preElements=document.querySelectorAll('pre');preElements.forEach(pre=>{if(pre.querySelector('.copy-code-btn')){return}const copyBtn=document.createElement('button');copyBtn.className='copy-code-btn';copyBtn.textContent='复制';copyBtn.title='复制代码';pre.appendChild(copyBtn);copyBtn.addEventListener('click',()=>{const code=pre.querySelector('code').textContent;copyToClipboard(code,copyBtn)});const code=pre.querySelector('code');if(code&&code.innerHTML){addLineNumbers(pre,code)}});const codeElements=document.querySelectorAll('code:not(pre code)');codeElements.forEach(codeElement=>{codeElement.addEventListener('click',()=>{copyToClipboard(codeElement.textContent,'')})})}function copyToClipboard(text,copyBtn){if(navigator.clipboard){navigator.clipboard.writeText(text).then(()=>{if(!isEmpty(copyBtn)){copyBtn.textContent='已复制!';copyBtn.classList.add('copied');setTimeout(()=>{copyBtn.textContent='复制';copyBtn.classList.remove('copied')},2500)}else{typeof show_tips==='function'&&show_tips('内容已复制',1000)}}).catch((err)=>{console.error("无法复制文本: ",err)})}else{const textarea=document.createElement("textarea");textarea.value=text;document.body.appendChild(textarea);textarea.select();try{document.execCommand("copy");if(!isEmpty(copyBtn)){copyBtn.textContent='已复制!';copyBtn.classList.add('copied');setTimeout(()=>{copyBtn.textContent='复制';copyBtn.classList.remove('copied')},2500)}else{typeof show_tips==='function'&&show_tips('内容已复制',1000)}}catch(err){console.error("无法复制文本: ",err)}document.body.removeChild(textarea)}}function addLineNumbers(pre,code){pre.classList.add('with-line-numbers');const lines=code.innerHTML.split('\n');let numberedCode='';lines.forEach((line,index)=>{if(line.trim()===''&&index===lines.length-1)return;numberedCode+=`<span class="line-number"></span>${line}\n`});code.innerHTML=numberedCode}function setupEventListeners(){menuHeadEventListeners();pageHeadEventListeners()}function pageHeadEventListeners(){navTabs.addEventListener('click',(e)=>{if(e.target.classList.contains('nav-tab-item')){const category=e.target.dataset.category;switchCategory(category)}});searchInput.addEventListener('input',debounce((e)=>{const query=e.target.value.trim();if(query.length>0){docs_query(query)}else{searchResults.style.display='none'}},1200));searchInput.addEventListener('keydown',function(event){if(event.key==='Enter'||event.keyCode===13){const query=this.value.trim();if(query.length>0){docs_query(query)}else{searchResults.style.display='none'}}});document.addEventListener('click',(e)=>{if(!searchContainer.contains(e.target)){searchResults.style.display='none'}});themeToggle.addEventListener('click',toggleTheme);languageToggle.addEventListener('click',(e)=>{e.stopPropagation();languageMenu.classList.toggle('show')});languageMenu.addEventListener('click',(e)=>{if(e.target.classList.contains('dropdown-item')){const lang=e.target.dataset.lang;switchLanguage(lang)}});document.addEventListener('click',(e)=>{if(!languageToggle.contains(e.target)){languageMenu.classList.remove('show')}});userAvatar.addEventListener('click',(e)=>{e.stopPropagation();userCard.classList.toggle('show')});document.addEventListener('click',(e)=>{if(!userAvatar.contains(e.target)){userCard.classList.remove('show')}});headerMenuToggle.addEventListener('click',(e)=>{e.stopPropagation();toggleHeaderMenu()});content.addEventListener('click',()=>{if(window.innerWidth<=900){closeMobileMenus()}});window.addEventListener('resize',handleResize)}function isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<900}function menuHeadEventListeners(){sidebarToggle.addEventListener('click',(e)=>{e.stopPropagation();toggleSidebar()});menuContainer.addEventListener('click',(e)=>{const menuLink=e.target.closest('.menu-link');if(!menuLink)return;e.preventDefault();const menuItem=menuLink.parentElement;const hasChildren=menuItem.classList.contains('has-children');const id=menuLink.dataset.id;const title=menuLink.querySelector('.menu-text').textContent.trim();if(hasChildren){menuItem.classList.toggle('open')}else{if(menuLink.dataset.menu_type==='dir'){return}const href=menuLink.getAttribute('href');if(menuLink.dataset.has_url){window.location.href=href;return}setActiveMenuItem(menuItem);loadContent(id,title,menuLink.dataset)}});tocToggle.addEventListener('click',()=>{tocCollapsed=true;updateTOCVisibility()});tocCollapseHandle.addEventListener('click',()=>{tocCollapsed=false;updateTOCVisibility()})}function docs_query(query){if(typeof custom_search_page=='function'){try{const results=custom_search_page(query);if(results){if(typeof results?.then==='function'){results.then(data=>{renderSearchResults(data);searchResults.style.display='block'}).catch(err=>{})}else{renderSearchResults(results);searchResults.style.display='block'}}}catch(err){searchResults.style.display='none'}}}function updateTOCVisibility(){if(!tocCollapseHandle){return}if(window.innerWidth<=900){tocCollapseHandle.style.display='none';return}if(tocCollapsed){toc.classList.add('toc-collapsed');tocCollapseHandle.style.display='flex'}else{toc.classList.remove('toc-collapsed');tocCollapseHandle.style.display='none'}}function showDocsToc(hidden=false){if(hidden){toc.classList.add('toc-collapsed');toc.style.display='none'}else{toc.classList.remove('toc-collapsed');toc.style.display='block'}}function toggleSidebar(){sidebarOpen=!sidebarOpen;sidebar.classList.toggle('open',sidebarOpen)}function isEmpty(value){if(value===null||value===undefined)return true;if(typeof value==='string'&&(value.trim()===''||value==='undefined'))return true;if(Array.isArray(value)&&value.length===0)return true;if(typeof value==='object'&&Object.keys(value).length===0)return true;return false}function switchCategory(category){category=!isEmpty(category)?category:defaultCategory;currentCategory=category;navTabItems.forEach(tab=>tab.classList.remove('active'));document.querySelector(`.nav-tab[data-category="${category}"]`)?.classList.add('active');renderMenu(category);if(window.innerWidth<=900){closeMobileMenus()}setTimeout(()=>{typeof init_right_menu=='function'&&init_right_menu()},100)}function setActiveMenuItem(menuItem){document.querySelectorAll('.menu-item').forEach(item=>{item.classList.remove('active')});menuItem.classList.add('active')}function loadContent(id,title,dataset){if(typeof custom_load_page=='function'){try{const result=custom_load_page(id,title,dataset);if(result){if(result instanceof Promise){result.then(data=>{renderMenu(currentCategory,id)}).catch(err=>{})}else{renderMenu(currentCategory,id)}}}catch(syncErr){console.error('同步调用错误:',syncErr)}}else{renderMenu(currentCategory,id)}document.getElementById('content').scrollTo(0,0)}function jsonToFormData(json){const formData=new FormData();for(const key in json){if(json.hasOwnProperty(key)){formData.append(key,json[key])}}return formData}function pjax_request(url,data,success,error,method='GET'){const config={method,headers:{'X-PJAX':'true','X-Requested-With':'XMLHttpRequest','X-CSRF-TOKEN':getCsrfToken()},mode:'cors',};if(method.toUpperCase()==='POST'){config.body=jsonToFormData(data)}return fetch(url,config).then(async response=>{const data=await response.json().catch(()=>({}));return response.ok?data:Promise.reject({...data,status:response.status,statusText:response.statusText})}).then(data=>{if(data){if(typeof success=='function'){let res=success(data);initDocContent();return res}}}).catch(err=>{error&&error(err);throw err;})}function http_request(url,data,success,error,method='GET'){const config={method,headers:{'X-Requested-With':'XMLHttpRequest','X-CSRF-TOKEN':getCsrfToken()},mode:'cors',};if(method.toUpperCase()==='POST'){config.body=jsonToFormData(data)}return fetch(url,config).then(async response=>{const data=await response.json().catch(()=>({}));return response.ok?data:Promise.reject({...data,status:response.status,statusText:response.statusText})}).then(data=>{if(data){if(typeof success=='function'){return success(data)}}}).catch(err=>{error&&error(err);typeof show_tips==='function'&&show_tips(err.message||err.msg||'请求失败',3200)})}function toggleTheme(){const currentTheme=document.documentElement.getAttribute('data-theme');initTheme(currentTheme==='dark'?'light':'dark')}function switchLanguage(lang){console.log(`切换语言:${lang}`);currentLanguage=lang;updateUIForLanguage();languageMenu.classList.remove('show');langBadge.textContent=langCodeMap[lang]||lang.substring(0,2).toUpperCase()}function toggleHeaderMenu(){headerMenuOpen=!headerMenuOpen;navTabs.classList.toggle('open',headerMenuOpen);searchContainer.classList.toggle('open',headerMenuOpen)}function closeMobileMenus(){sidebarOpen=false;sidebar?.classList.remove('open');headerMenuOpen=false;navTabs.classList.remove('open');searchContainer.classList.remove('open')}function handleResize(){if(window.innerWidth>900){closeMobileMenus()}updateTOCVisibility();if(isMobile()){(typeof cherry!=='undefined')&&setTimeout(function(){cherry.switchModel('editOnly')},400)}else{(typeof cherry!=='undefined')&&setTimeout(function(){cherry.switchModel('edit&preview')},400)}}function debounce(func,wait){let timeout;return function(){const context=this,args=arguments;clearTimeout(timeout);timeout=setTimeout(()=>{func.apply(context,args)},wait)}}function renderSearchResults(results){if(results.length>0){searchResults.innerHTML=results.map(result=>{result.category=!isEmpty(result.category)?result.category:defaultCategory;let in_docs_app_inner_search=true;if(result.app&&result.app.app_name){result.category=result.app.app_name;in_docs_app_inner_search=false}let hasUrl=(!isEmpty(result.url)&&result.url!=='#'&&result.url!=='javascript:;');let datasetStr=hasUrl?`data-id="${result.id}"`:generateDatasetStr(result);return`<div class="search-result-item"data-has_url="${hasUrl ? 1 : ''}"${datasetStr}data-in_app_inner="${in_docs_app_inner_search?'1':''}"><div class="result-title">${result.icon||''}${result.title}</div><div class="result-content">${result.content.substring(0,60)}...</div><div class="result-category">${i18nData[currentLanguage][result.category]||result.category}</div></div>`}).join('');document.querySelectorAll('.search-result-item').forEach(item=>{item.addEventListener('click',()=>{const category=item.dataset.category;const id=item.dataset.id;const title=item.querySelector('.result-title').textContent.trim();currentCategory=category;switchCategory(category);if(item.dataset.menu_type==='dir'){return}if(item.dataset.has_url){window.location.href=item.getAttribute('href');return}loadContent(id,title,item.dataset);searchResults.style.display='none';searchInput.value=''})})}else{searchResults.innerHTML=`<div class="search-result-item">${i18nData[currentLanguage].noResults}</div>`}}function generateTOC(){if(tocList==null){return}const headings=articleContent.querySelectorAll('h1, h2, h3, h4, h5');let tocHTML='';headings.forEach(heading=>{const id=heading.id||heading.textContent.toLowerCase().replace(/\s+/g,'-');heading.id=id;const level=parseInt(heading.tagName.substring(1));const className=`toc-item-h${level}`;tocHTML+=`<li class="toc-item ${className}"><a href="#${id}"class="toc-link">${heading.textContent}</a></li>`});tocList.innerHTML=tocHTML;tocList.querySelectorAll('.toc-link')?.forEach(link=>{link.addEventListener('click',(e)=>{e.preventDefault();const targetId=link.getAttribute('href').substring(1);const targetElement=document.getElementById(targetId);if(targetElement){window.scrollTo({top:targetElement.offsetTop-20,behavior:'smooth'})}})})}function setupScrollSpy(){const headings=articleContent?.querySelectorAll('h1, h2, h3, h4, h5');const tocLinks=tocList?.querySelectorAll('.toc-link');window.addEventListener('scroll',()=>{let currentActive=null;const scrollPosition=window.scrollY+100;headings?.forEach(heading=>{if(heading.offsetTop<=scrollPosition){currentActive=heading.id}});tocLinks?.forEach(link=>{link.classList.remove('active');if(link.getAttribute('href')===`#${currentActive}`){link.classList.add('active')}})})}function setupBackToTop(){window.addEventListener('scroll',()=>{if(window.pageYOffset>300){backToTop.classList.add('visible')}else{backToTop.classList.remove('visible')}});backToTop.addEventListener('click',()=>{window.scrollTo({top:0,behavior:'smooth'})})}function updateUIForLanguage(){const langData=i18nData[currentLanguage]||i18nData['zh-CN'];searchInput.placeholder=langData.searchPlaceholder;if(tocTitleText){tocTitleText.textContent=langData.tocTitle;tocToggle.textContent=langData.tocToggle}footerText.textContent=langData.footerText;document.querySelectorAll('.footer a')[0].textContent=langData.about;document.querySelectorAll('.footer a')[1].textContent=langData.help;document.querySelectorAll('.footer a')[2].textContent=langData.privacy;logoText&&(logoText.textContent=langData.logoText);document.querySelector('.tooltip-text',sidebarToggle).textContent=langData.toggleMenu;document.querySelector('.tooltip-text',themeToggle).textContent=langData.toggleTheme;document.querySelector('.tooltip-text',languageToggle).textContent=langData.toggleLanguage;document.querySelector('.tooltip-text',headerMenuToggle).textContent=langData.moreOptions;if(searchResults.style.display==='block'){}}class CustomTabs{constructor(tabsContainer){this.tabsContainer=tabsContainer||document;this.tabLinks=this.tabsContainer.querySelectorAll('.custom-tabs a');this.tabContents=this.tabsContainer.querySelectorAll('.tab-content');this.html=document.documentElement;const _this=this;this.tabLinks.forEach(link=>{link.addEventListener('click',function(e){e.preventDefault();if(this.id!=='current'){_this.switchTab(this)}})});this.initTabs()}initTabs(){if(this.tabLinks.length>0&&this.tabContents.length>0){this.tabLinks[0].id='current';this.tabContents[0].classList.add('active')}this.handleHash()}switchTab(clickedLink){this.tabLinks.forEach(link=>link.id='');this.tabContents.forEach(content=>content.classList.remove('active'));clickedLink.id='current';const target=document.querySelector(clickedLink.getAttribute('name'));if(target)target.classList.add('active');const tabName=clickedLink.getAttribute('name');if(tabName){history.replaceState(null,null,tabName)}}handleHash(){const hash=window.location.hash;if(hash){const matchingLink=Array.from(this.tabLinks).find(link=>link.getAttribute('name')===hash);if(matchingLink)this.switchTab(matchingLink)}}}window.CustomTabs=CustomTabs;new CustomTabs();function listenFileChangeURL(inputFileEle,successFun){const element=typeof inputFileEle==='string'?document.querySelector(inputFileEle):inputFileEle;if(!element){console.error('Element not found:',inputFileEle);return function(){}}let lastFile=null;const handleFileChange=function(e){const files=e.target.files;if(!files||files.length===0)return;const file=files[0];if(lastFile&&lastFile.name===file.name&&lastFile.size===file.size&&lastFile.lastModified===file.lastModified){return}lastFile=file;const url=window.URL||window.webkitURL||window.mozURL;let file_src;try{file_src=url&&url.createObjectURL?url.createObjectURL(file):element.value||(e.target.result||'')}catch(error){console.error('Error creating object URL:',error);file_src=element.value||''}if(successFun&&typeof successFun==='function'){successFun(file_src,e.target)}};element.addEventListener('change',handleFileChange);return function(){element.removeEventListener('change',handleFileChange);lastFile=null}}function init_alert(){const alertContainer=document.querySelector('.alert-fixed-container');if(!alertContainer)return;alertContainer.addEventListener('click',function(e){if(e.target.matches('.alert-close')||e.target.closest('.alert-close')){const closeBtn=e.target.matches('.alert-close')?e.target:e.target.closest('.alert-close');const alertElement=closeBtn.closest('.alert');if(alertElement){alertElement.remove()}}});function setupAutoDismiss(alertElement){const timer=setTimeout(()=>{alertElement.remove()},8500);alertElement.addEventListener('mouseenter',()=>{clearTimeout(timer)});alertElement.addEventListener('mouseleave',()=>{setTimeout(()=>{alertElement.remove()},8500)})}const existingAlerts=alertContainer.querySelectorAll('.alert');existingAlerts.forEach(alert=>{setupAutoDismiss(alert)});const observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){mutation.addedNodes.forEach(function(node){if(node.nodeType===1&&node.matches('.alert')){setupAutoDismiss(node)}if(node.nodeType===1&&node.querySelector('.alert')){node.querySelectorAll('.alert').forEach(alert=>{setupAutoDismiss(alert)})}})})});observer.observe(alertContainer,{childList:true,subtree:true})}document.addEventListener('DOMContentLoaded',function(){init_alert()});function init_tips(){var Tips={config:{className:'tips-container',arrowClassName:'tips-arrow',allowTypes:['top','bottom','left','right','track'],defaultType:'track',showDelay:60,hideDelay:150,offset:12,trackOffset:{x:0,y:15},maxWidth:300,arrowSize:8,checkViewport:true},tipElement:null,tipArrow:null,currentTarget:null,showTimeout:null,hideTimeout:null,lastPosition:null,scrollListener:null,resizeListener:null,init:function(options){if(options){for(var key in options){if(this.config.hasOwnProperty(key)){this.config[key]=options[key]}}}this.setupListeners();this.setupEventListeners()},setupListeners:function(){if(this.scrollListener){window.removeEventListener('scroll',this.scrollListener)}if(this.resizeListener){window.removeEventListener('resize',this.resizeListener)}this.scrollListener=this.handleScroll.bind(this);this.resizeListener=this.handleResize.bind(this);window.addEventListener('scroll',this.scrollListener,{passive:true});window.addEventListener('resize',this.resizeListener,{passive:true})},handleScroll:function(){if(this.tipElement&&this.tipElement.style.display==='block'){var tipType=this.getCurrentTipType();var target=tipType==='track'?this.lastPosition:this.currentTarget;this.positionTip(target,tipType)}},handleResize:function(){this.handleScroll()},getCurrentTipType:function(){if(!this.tipElement)return this.config.defaultType;for(var i=0;i<this.config.allowTypes.length;i++){if(this.tipElement.classList.contains(this.config.allowTypes[i])){return this.config.allowTypes[i]}}return this.config.defaultType},setupEventListeners:function(){this.removeEventListeners();var elements=document.querySelectorAll('[data-tips]');for(var i=0;i<elements.length;i++){var el=elements[i];if(!el.dataset.tipsInitialized){el.dataset.originalTitle=el.title;el.title='';el.dataset.tipsInitialized='true';el.addEventListener('mouseenter',this.handleMouseEnter.bind(this));el.addEventListener('mouseleave',this.handleMouseLeave.bind(this));el.addEventListener('mousemove',this.handleMouseMove.bind(this))}}},removeEventListeners:function(){var elements=document.querySelectorAll('[data-tips][data-tips-initialized="true"]');for(var i=0;i<elements.length;i++){var el=elements[i];el.removeEventListener('mouseenter',this.handleMouseEnter);el.removeEventListener('mouseleave',this.handleMouseLeave);el.removeEventListener('mousemove',this.handleMouseMove)}},handleMouseEnter:function(e){this.currentTarget=e.currentTarget;clearTimeout(this.hideTimeout);this.updateLastPosition(e);this.showTimeout=setTimeout(function(){this.showTip(this.currentTarget)}.bind(this),this.config.showDelay)},updateLastPosition:function(e){this.lastPosition={x:e.clientX,y:e.clientY,scrollX:window.scrollX||document.documentElement.scrollLeft,scrollY:window.scrollY||document.documentElement.scrollTop,target:e.currentTarget}},handleMouseLeave:function(){clearTimeout(this.showTimeout);this.hideTimeout=setTimeout(function(){this.hideTip()}.bind(this),this.config.hideDelay)},handleMouseMove:function(e){this.updateLastPosition(e);if(this.tipElement&&this.tipElement.classList.contains('track')){if(this.tipElement.style.display==='block'){this.positionTip(this.lastPosition,'track')}}},createTipElement:function(){if(!this.tipElement||!document.body.contains(this.tipElement)){this.tipElement=document.createElement('div');this.tipElement.className=this.config.className;this.tipArrow=document.createElement('div');this.tipArrow.className=this.config.arrowClassName;this.tipElement.appendChild(this.tipArrow);Object.assign(this.tipElement.style,{position:'absolute',maxWidth:this.config.maxWidth+'px',display:'none',zIndex:'9999',pointerEvents:'none'});document.body.appendChild(this.tipElement)}return this.tipElement},showTip:function(target){var content=target.dataset.originalTitle||'';if(!content)return;var tipElement=this.createTipElement();this.setContent(tipElement,content);var tipType=this.getTipType(target);this.forceReflow(tipElement);this.positionTip(tipType==='track'?this.lastPosition:target,tipType);tipElement.classList.add(tipType,'visible');tipElement.style.display='block'},forceReflow:function(element){return element.offsetHeight},hideTip:function(){if(this.tipElement){this.tipElement.classList.remove('visible');setTimeout(function(){if(this.tipElement&&!this.tipElement.classList.contains('visible')){this.tipElement.style.display='none'}}.bind(this),this.config.hideDelay)}},setContent:function(element,content){while(element.childNodes.length>1){element.removeChild(element.lastChild)}var contentWrapper=document.createElement('div');contentWrapper.style.margin='0';contentWrapper.style.padding='0';if(/^[.#]/.test(content)){var targetEl=document.querySelector(content);if(targetEl){var clone=targetEl.cloneNode(true);clone.style.display='block';clone.style.visibility='visible';contentWrapper.appendChild(clone)}}else if(/^</.test(content)){contentWrapper.innerHTML=content}else{var textContent=content.replace(/\n/g,' ').replace(/\\n/g,'\n');var lines=textContent.split('\n');for(var i=0;i<lines.length;i++){if(i>0)contentWrapper.appendChild(document.createElement('br'));contentWrapper.appendChild(document.createTextNode(lines[i]))}}element.appendChild(contentWrapper)},getTipType:function(element){var type=(element.dataset.tips||'').toLowerCase();return this.config.allowTypes.includes(type)?type:this.config.defaultType},positionTip:function(target,type){if(!this.tipElement)return;this.config.allowTypes.forEach(function(t){this.tipElement.classList.remove(t)},this);this.tipElement.classList.add(type);if(type==='track'){this.positionTrackTip(target)}else{this.positionStaticTip(target,type)}},positionStaticTip:function(element,type){var tipRect=this.tipElement.getBoundingClientRect();var targetRect=element.getBoundingClientRect();var scrollX=window.scrollX||document.documentElement.scrollLeft;var scrollY=window.scrollY||document.documentElement.scrollTop;var top=0,left=0;switch(type){case'top':top=targetRect.top+scrollY-tipRect.height-this.config.offset;left=targetRect.left+scrollX+targetRect.width/2-tipRect.width/2;break;case'bottom':top=targetRect.top+scrollY+targetRect.height+this.config.offset;left=targetRect.left+scrollX+targetRect.width/2-tipRect.width/2;break;case'left':top=targetRect.top+scrollY+targetRect.height/2-tipRect.height/2;left=targetRect.left+scrollX-tipRect.width-this.config.offset;break;case'right':top=targetRect.top+scrollY+targetRect.height/2-tipRect.height/2;left=targetRect.left+scrollX+targetRect.width+this.config.offset;break}if(this.config.checkViewport){var viewportWidth=window.innerWidth;var viewportHeight=window.innerHeight;left=Math.max(0,Math.min(left,viewportWidth+scrollX-tipRect.width));top=Math.max(0,Math.min(top,viewportHeight+scrollY-tipRect.height))}this.tipElement.style.left=Math.round(left)+'px';this.tipElement.style.top=Math.round(top)+'px'},positionTrackTip:function(position){this.tipElement.style.display='block';var tipRect=this.tipElement.getBoundingClientRect();var left=position.x+this.config.trackOffset.x;var top=position.y+this.config.trackOffset.y;if(this.config.checkViewport){var viewportWidth=window.innerWidth;var viewportHeight=window.innerHeight;left=Math.max(0,Math.min(left,viewportWidth-tipRect.width));top=Math.max(0,Math.min(top,viewportHeight-tipRect.height))}this.tipElement.style.left=Math.round(left+(position.scrollX||0))+'px';this.tipElement.style.top=Math.round(top+(position.scrollY||0))+'px'},update:function(){this.setupEventListeners()},destroy:function(){this.removeEventListeners();if(this.scrollListener){window.removeEventListener('scroll',this.scrollListener)}if(this.resizeListener){window.removeEventListener('resize',this.resizeListener)}if(this.tipElement&&document.body.contains(this.tipElement)){document.body.removeChild(this.tipElement)}var elements=document.querySelectorAll('[data-tips]');for(var i=0;i<elements.length;i++){var el=elements[i];if(el.dataset.originalTitle){el.title=el.dataset.originalTitle;delete el.dataset.originalTitle;delete el.dataset.tipsInitialized}}this.tipElement=null;this.tipArrow=null;this.currentTarget=null;this.lastPosition=null}};Tips.init()}function page_loading(message='加载中...'){new Modal({content:`${message}`,theme:getTheme()==='dark'?'dark':'default',}).open()}function show_tips(message='提示',time=3500){new Modal({content:`${message}`,width:100,autoClose:time,theme:getTheme()==='dark'?'dark':'default',}).open()}function custom_load_page(id,title,dataset){let docUrl,pageUrl;let appId=dataset.app_id||dataset.doc_app_id||app_id;if(dataset.menu_type==='app_manage_doc'){docUrl='/docs/'+appId+'/'+id;pageUrl=docUrl}else{docUrl='/docs/doc/doc_'+id;pageUrl='/docs/doc/'+app_id+'_'+id}if(dataset.hasOwnProperty('in_app_inner')){if(isEmpty(dataset.in_app_inner)){docUrl='/docs/doc/'+appId+'_'+id;pageUrl=docUrl;window.location.href=pageUrl;return false}}page_loading(`正在加载[${title}]...`);return pjax_request(docUrl,{},function(data){window.history.pushState(null,'',pageUrl);setArticleHTML(data.content_html||'');Modal.closeAll()},function(err){Modal.closeAll();const errorMsg=`${err.status}:加载失败`;Modal.error(errorMsg,{position:'top-center',timeout:3000})},"GET")}function setArticleHTML(html){if(window._temp_init_page){delete window._temp_init_page}document.getElementById('articleContent').innerHTML=html;const scripts=document.getElementById('articleContent').querySelectorAll('script');scripts.forEach(script=>{if(script.textContent.includes(' init_page(')){try{const fn=new Function(`${script.textContent}return typeof init_page==='function'?init_page:null;`);const currentInitPage=fn();if(currentInitPage){window._temp_init_page=currentInitPage;console.log("Executing current init_page");currentInitPage()}}catch(e){console.error("Error parsing init_page:",e)}}});initDocContent()}function custom_search_page(keyword){let search_url='/docs/search/'+(app_id||'');page_loading('搜索中...');return pjax_request(search_url,{keyword:keyword,_token:getCsrfToken()},function(data){Modal.closeAll();return data.list},function(err){console.log(err);Modal.closeAll();const errorMsg=`${err.status}:搜索失败`;Modal.error(errorMsg,{position:'top-center',timeout:3000})},'POST')}document.addEventListener('submit',async function(e){const form=e.target.closest('form');if(!form)return;e.preventDefault();e.stopImmediatePropagation();const submitter=e.submitter||form.querySelector('[type="submit"]');let submitterText=submitter?submitter.innerHTML:'';if(submitter){submitter.disabled=true;submitter.innerHTML=submitterText+'...';submitter.style.opacity='0.7';submitter.style.cursor='not-allowed'}let resetSubmit=function(){if(submitter){submitter.disabled=false;submitter.innerHTML=submitterText;submitter.style.opacity='1';submitter.style.cursor=''}};try{if(typeof form_intercept==='function'){if(form_intercept(e)===false){resetSubmit();return false}}if(typeof form_before==='function'){if(form_before()===false){resetSubmit();return false}}form.removeEventListener('submit',arguments.callee,true);form.submit()}catch(error){resetSubmit()}},true);function handleImageFallback(defaultImage){if(!defaultImage){console.error('必须提供默认图片URL');return}const processImage=(img)=>{if(img.dataset.fallbackProcessed||img.src===defaultImage){return}img.dataset.fallbackProcessed='true';img.dataset.originalSrc=img.src;const errorHandler=()=>{img.removeEventListener('error',errorHandler);img.src=defaultImage};img.addEventListener('error',errorHandler);if(img.complete&&img.naturalHeight===0){errorHandler()}};const initExistingImages=()=>{document.querySelectorAll('img').forEach(processImage)};const setupObserver=()=>{const observer=new MutationObserver((mutations)=>{mutations.forEach((mutation)=>{mutation.addedNodes.forEach((node)=>{if(node.nodeName==='IMG'){processImage(node)}else if(node.querySelectorAll){node.querySelectorAll('img').forEach(processImage)}})})});observer.observe(document.body,{childList:true,subtree:true});return observer};initExistingImages();return setupObserver()}handleImageFallback('/static/images/system/load_error.jpg');
